"use client"

import * as React from "react"
import Link from "next/link"
import { useRouter } from "next/navigation"
import { Shrub } from "lucide-react"

import {
  NavigationMenu,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  navigationMenuTriggerStyle,
} from "@/components/ui/navigation-menu"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"
import { Input } from "@/components/ui/input"
import { cn } from "@/lib/utils"

import { ModeToggle } from "@/components/shared/buttons/mode-toggle"
import { TypographyP } from "@/components/shared/typography/typography-p"
import { NAV_LINKS } from "@/constants/app/navigation"

const NavBar = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => {
  const router = useRouter()
  const [jobSearchValue, setJobSearchValue] = React.useState<string>("")
  
  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()
    router.push(`/gl_job/${jobSearchValue}`)
    setJobSearchValue("")
  }

  const renderLogo = () => {
    return <Shrub className="h-[1.2rem] w-[1.2rem]" />
  }
  
  const renderNavMenu = () => {
    return (
      <NavigationMenu>
        <NavigationMenuList>
          {NAV_LINKS.map((link) => (
            <NavigationMenuItem key={link.key}>
              <TooltipProvider>
                <Tooltip>
                  <TooltipTrigger>
                    <Link href={link.href} legacyBehavior passHref>
                      <NavigationMenuLink className={cn(navigationMenuTriggerStyle(), "dark:bg-slate-900 hover:dark:bg-slate-800")}>
                        {link.title}
                      </NavigationMenuLink>
                    </Link>
                  </TooltipTrigger>
                  <TooltipContent>
                    <TypographyP>
                      {link.description}  
                    </TypographyP>
                  </TooltipContent>
                </Tooltip>
              </TooltipProvider>
            </NavigationMenuItem>
          ))}
          <NavigationMenuItem>
            <form onSubmit={handleSubmit}>
              <Input
                placeholder="Search GitLab Job ID..."
                className="h-8 w-[150px] lg:w-[250px] text-ellipsis"
                onChange={(e) => setJobSearchValue(e.target.value)}
                value={jobSearchValue}
              />
            </form>
          </NavigationMenuItem>
        </NavigationMenuList>
      </NavigationMenu>
    )
  }

  return (
    <nav className={cn("sticky pt-5 pb-2.5 top-0 z-10", className)}>
      <div className="border border-dashed rounded-lg shadow-lg w-11/12 max-w-7xl m-auto bg-white dark:bg-slate-900 z-10">
        <div className="w-11/12 m-auto">
          <div className="flex items-center justify-between h-16">
            {renderLogo()}
            {renderNavMenu()}
            <ModeToggle />
          </div>
        </div>
      </div>
    </nav>
  )
}

export { NavBar }
