import useSWR from "swr";

import { fetcher } from "@/lib/fetcher";

import { IStatusScanJob, SortOrders } from "@/types/workers-status/status-scan-job";
import { TaskStatuses } from "@/types/workers-status/status-scan-job"
import { GET_ALL_BY_OVERALL_STATUS } from "@/constants/api/workers-status";

const useStatusScanJobsStatusOverallStatus = (
  overallStatus: TaskStatuses,
  limit: number,
  sort: SortOrders,
  longPolling: boolean = false,
) => {
  const apiUrl = `${GET_ALL_BY_OVERALL_STATUS}?` + new URLSearchParams({
    overall_status: overallStatus,
    limit: limit.toString(),
    sort: sort
  }).toString()

  const { data, error, isLoading, isValidating } = useSWR<IStatusScanJob[]>(
    `${apiUrl}`,
    fetcher,
    {
      refreshInterval: longPolling ? 5000 : 0 // Disabled by default
    }
  )

  return {
    data,
    isError: error,
    isLoading,
    isValidating
  }
}

export { useStatusScanJobsStatusOverallStatus }
